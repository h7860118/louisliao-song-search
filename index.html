<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è·¯æ˜“æ–¯é‹¼ç´ç¨å¥è­œæŸ¥è©¢</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "PingFang TC", "Microsoft JhengHei", sans-serif;
      background: #f5f7fb;
      color: #1f2933;
    }
    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 16px 80px;
    }
    h1 {
      font-size: 28px;
      font-weight: 700;
      margin: 0 0 8px;
    }
    .subtitle {
      font-size: 15px;
      color: #6b7280;
      margin-bottom: 24px;
    }
    .search-row {
      display: flex;
      gap: 16px;
      align-items: stretch;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .search-input-wrap {
      flex: 1 1 260px;
      position: relative;
    }
    .search-input-wrap input {
      width: 100%;
      padding: 14px 16px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 16px;
      outline: none;
      box-sizing: border-box;
    }
    .search-input-wrap input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
    }
    .search-btn {
      flex: 0 0 auto;
      padding: 0 32px;
      border-radius: 999px;
      border: none;
      background: #2563eb;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      min-width: 96px;
    }
    .search-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .tip {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 24px;
    }
    .status {
      font-size: 14px;
      color: #6b7280;
      margin-top: 8px;
    }
    .results {
      margin-top: 8px;
    }
    .result-count {
      font-size: 14px;
      color: #4b5563;
      margin-bottom: 8px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 10px;
      box-shadow: 0 6px 18px rgba(15,23,42,0.06);
      border: 1px solid #e5e7eb;
    }
    .song-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .links a {
      font-size: 14px;
      color: #2563eb;
      text-decoration: none;
      margin-right: 12px;
    }
    .links a:hover {
      text-decoration: underline;
    }
    .badge {
      display: inline-block;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      margin-left: 6px;
    }
    @media (max-width: 640px) {
      .page { padding: 20px 12px 48px; }
      h1 { font-size: 22px; }
    }

    /* --------- LINE å®¢æœæ¼‚æµ®æŒ‰éˆ• + å½ˆå‡ºè¦–çª— --------- */
    #lineFab {
      position: fixed;
      right: 22px;
      bottom: 22px;
      width: 58px;
      height: 58px;
      border-radius: 50%;
      z-index: 999;
      text-decoration: none;
      cursor: grab;
      touch-action: none;
    }
    #lineFab:active {
      cursor: grabbing;
    }
    .line-fab-inner {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: #06C755;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 24px rgba(0,0,0,.3);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    #lineFab:hover .line-fab-inner {
      transform: translateY(-1px);
      box-shadow: 0 13px 28px rgba(0,0,0,.35);
    }
    #lineFab svg {
      width: 34px;
      height: 34px;
      display: block;
    }

    .line-modal-overlay {
      position: fixed;
      inset: 0;
      display: none;
      justify-content: flex-end;
      align-items: center;
      background: rgba(0,0,0,.25);
      z-index: 998;
    }
    .line-modal {
      width: 320px;
      max-width: 90vw;
      background: #ffffff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      margin-right: 22px;
    }
    .line-modal-header {
      background: #06C755;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      font-size: 15px;
      font-weight: 600;
    }
    .line-modal-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .line-modal-logo-circle {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #06C755;
      font-weight: 700;
    }
    .line-modal-close {
      border: none;
      background: transparent;
      color: #ffffff;
      font-size: 20px;
      line-height: 1;
      cursor: pointer;
      padding: 0 4px;
    }
    .line-modal-body {
      padding: 16px 18px 20px;
      text-align: center;
    }
    .line-modal-qr {
      width: 210px;
      height: 210px;
      object-fit: contain;
      display: block;
      margin: 0 auto 14px;
    }
    .line-modal-link {
      display: inline-block;
      font-size: 14px;
      color: #7b3bb2;
      text-decoration: none;
      word-break: break-all;
    }
    .line-modal-link:hover {
      text-decoration: underline;
    }
    @media (max-width: 640px) {
      .line-modal { margin-right: 12px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>è·¯æ˜“æ–¯é‹¼ç´ç¨å¥è­œæŸ¥è©¢</h1>
    <div class="subtitle">
      è¼¸å…¥æ­Œåæˆ–æ¼”å”±è€…çš„ä¸€éƒ¨åˆ†å³å¯æ¨¡ç³Šæœå°‹ï¼Œä¾‹å¦‚ã€Œç«¥è©±ã€ã€Œå…‰è‰¯ã€ã€Œæ¶¼æ¶¼ã€ç­‰ã€‚
    </div>

    <div class="search-row">
      <div class="search-input-wrap">
        <input
          id="keyword"
          type="text"
          placeholder="è¼¸å…¥æ­Œåï¼æ¼”å”±è€…é—œéµå­—â€¦"
        />
      </div>
      <button id="searchBtn" class="search-btn">æœå°‹</button>
    </div>

    <div class="tip">
      ğŸ” å°ç§˜è¨£ï¼šå¯ä»¥ç”¨æ­Œåã€æ­Œæ‰‹ã€æˆ–æ˜¯éƒ¨åˆ†é—œéµå­—ä¾†æ‰¾ï¼Œä¾‹å¦‚ã€Œè˜‡æ°¸åº·ã€ã€Œé‡å›å‚·å¿ƒåœ°ã€ã€‚
    </div>

    <div id="status" class="status">ç›®å‰è¼‰å…¥ä¸­â€¦</div>

    <div id="results" class="results"></div>
  </div>

  <!-- LINE å®¢æœæ¼‚æµ®æŒ‰éˆ• -->
  <a id="lineFab" href="https://lin.ee/aAgocM5"
     target="_blank" rel="noopener" aria-label="åŠ å…¥ LINE å®˜æ–¹å¸³è™Ÿ">
    <div class="line-fab-inner">
      <svg viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g fill="none" fill-rule="evenodd">
          <path d="M18 4C10.82 4 5 9.01 5 15.19c0 4.37 2.77 7.94 7.02 9.6-.31 1.04-1.17 3.9-1.34 4.52-.21.8.29.79.61.58.25-.17 3.94-2.68 5.54-3.77.73.07 1.48.11 2.24.11 7.18 0 13-5.01 13-11.19C32.07 9.01 25.18 4 18 4z"
                fill="#FFFFFF"/>
          <path d="M12.6 14.05v5.14H11v-5.14H9.4v-1.6H13v1.6h-.4zm3.06 5.14h-1.6v-6.74h1.6v6.74zm4.56 0h-4.02v-6.74h1.6v5.14h2.42v1.6zm4.78 0l-1.9-2.94-.02 2.94h-1.6v-6.74h1.6l-.02 2.83 1.83-2.83h1.87l-2.16 3.17 2.27 3.57h-1.87z"
                fill="#06C755"/>
        </g>
      </svg>
    </div>
  </a>

  <!-- LINE å½ˆå‡ºè¦–çª—ï¼šQR å¡ç‰‡ -->
  <div id="lineModalOverlay" class="line-modal-overlay" aria-hidden="true">
    <div class="line-modal" role="dialog" aria-modal="true" aria-labelledby="lineModalTitle">
      <div class="line-modal-header">
        <div class="line-modal-header-left">
          <div class="line-modal-logo-circle">LINE</div>
          <div id="lineModalTitle">Line</div>
        </div>
        <button type="button" class="line-modal-close" aria-label="é—œé–‰">Ã—</button>
      </div>
      <div class="line-modal-body">
        <img
          class="line-modal-qr"
          src="https://raw.githubusercontent.com/h7860118/lyrics-space/main/line_oa_chat_210222_223854.jpg"
          alt="åŠ å…¥ LINE å¥½å‹ QR Code"
        />
        <a class="line-modal-link"
           href="https://lin.ee/aAgocM5"
           target="_blank"
           rel="noopener">
          https://lin.ee/aAgocM5
        </a>
      </div>
    </div>
  </div>

  <script>
    // âœ… é€™è£¡æ”¾ä½ çš„ Google Sheet CSV é€£çµ
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSOihjh1ceJIGyQQ49iBMcJoNS8Xqq_NW7nQVQ8gSQ89Hgo2yk4CA2fUNJjIEEdzqkcz2_2WfKlCQtV/pub?output=csv";

    let songs = [];
    const statusEl = document.getElementById("status");
    const resultsEl = document.getElementById("results");
    const searchInput = document.getElementById("keyword");
    const searchBtn = document.getElementById("searchBtn");

    // è®€å– CSV
    async function loadCSV() {
      try {
        statusEl.textContent = "æ­£åœ¨å¾è©¦ç®—è¡¨è¼‰å…¥è³‡æ–™â€¦";
        const res = await fetch(CSV_URL);
        if (!res.ok) throw new Error("è¼‰å…¥å¤±æ•—ï¼š" + res.status);
        const text = await res.text();

        // é€è¡Œè§£æ
        const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
        // å‡è¨­ç¬¬ä¸€åˆ—æ˜¯æ¨™é¡Œï¼šæ¨‚è­œæ¨™é¡Œ,é¦–é é è¦½,ç¤ºç¯„æ¼”å¥
        songs = lines.slice(1).map(line => {
          const cols = line.split(",");
          return {
            title: cols[0] ? cols[0].trim() : "",
            productUrl: cols[1] ? cols[1].trim() : "",
            youtubeUrl: cols[2] ? cols[2].trim() : ""
          };
        }).filter(s => s.title);

        statusEl.textContent = `è³‡æ–™è¼‰å…¥å®Œæˆï¼Œå…± ${songs.length} é¦–ã€‚`;
      } catch (err) {
        console.error(err);
        statusEl.textContent = "è®€å–è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œç¨å¾Œå†è©¦ä¸€æ¬¡ã€‚";
      }
    }

    // æœå°‹
    function doSearch() {
      const kw = searchInput.value.trim().toLowerCase();
      if (!kw) {
        resultsEl.innerHTML = "";
        statusEl.textContent = "è«‹å…ˆè¼¸å…¥é—œéµå­—å†æœå°‹ã€‚";
        return;
      }
      if (!songs.length) {
        statusEl.textContent = "è³‡æ–™å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
        return;
      }

      const filtered = songs.filter(s =>
        s.title.toLowerCase().includes(kw)
      );

      renderResults(filtered, kw);
    }

    function renderResults(list, kw) {
      if (!list.length) {
        resultsEl.innerHTML = "";
        statusEl.textContent = `æ‰¾ä¸åˆ°ç¬¦åˆã€Œ${kw}ã€çš„çµæœã€‚`;
        return;
      }

      statusEl.textContent = "";
      let html = `<div class="result-count">æ‰¾åˆ° ${list.length} ç­†ç¬¦åˆã€Œ${kw}ã€çš„çµæœï¼š</div>`;
      html += list.map(s => `
        <div class="card">
          <div class="song-title">
            ${s.title}
            <span class="badge">é‹¼ç´ç¨å¥è­œ</span>
          </div>
          <div class="links">
            ${s.productUrl ? `<a href="${s.productUrl}" target="_blank" rel="noopener">é¦–é é è¦½ï¼ˆå•†å“é ï¼‰</a>` : ""}
            ${s.youtubeUrl ? `<a href="${s.youtubeUrl}" target="_blank" rel="noopener">ç¤ºç¯„æ¼”å¥ï¼ˆYouTubeï¼‰</a>` : ""}
          </div>
        </div>
      `).join("");

      resultsEl.innerHTML = html;
    }

    // äº‹ä»¶ç¶å®š
    searchBtn.addEventListener("click", doSearch);
    searchInput.addEventListener("keydown", e => {
      if (e.key === "Enter") doSearch();
    });

    // é é¢è¼‰å…¥å°±å…ˆæŠ“è³‡æ–™
    loadCSV();

    /* ---- LINE æŒ‰éˆ•æ‹–æ›³ + å½ˆå‡ºè¦–çª— ---- */
    const fab = document.getElementById("lineFab");
    const overlay = document.getElementById("lineModalOverlay");
    const closeBtn = document.querySelector(".line-modal-close");

    if (fab) {
      let dragging = false;
      let dragMoved = false;
      let offsetX = 0;
      let offsetY = 0;
      let pointerId = null;

      fab.addEventListener("pointerdown", (e) => {
        dragging = true;
        dragMoved = false;
        pointerId = e.pointerId;
        fab.setPointerCapture(pointerId);

        const rect = fab.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;

        fab.style.transition = "none";
      });

      window.addEventListener("pointermove", (e) => {
        if (!dragging || e.pointerId !== pointerId) return;

        dragMoved = true;

        let x = e.clientX - offsetX;
        let y = e.clientY - offsetY;

        const margin = 8;
        const maxX = window.innerWidth - fab.offsetWidth - margin;
        const maxY = window.innerHeight - fab.offsetHeight - margin;

        x = Math.min(Math.max(margin, x), maxX);
        y = Math.min(Math.max(margin, y), maxY);

        fab.style.left = x + "px";
        fab.style.top = y + "px";
        fab.style.right = "auto";
        fab.style.bottom = "auto";
      });

      window.addEventListener("pointerup", (e) => {
        if (!dragging || e.pointerId !== pointerId) return;

        dragging = false;
        fab.releasePointerCapture(pointerId);
        pointerId = null;

        fab.style.transition = "";
      });

      fab.addEventListener("click", (e) => {
        if (dragMoved) {
          dragMoved = false;
          return;
        }

        e.preventDefault();

        if (overlay) {
          overlay.style.display = "flex";
          overlay.setAttribute("aria-hidden", "false");
        } else {
          const href = fab.getAttribute("href");
          if (href) window.open(href, "_blank");
        }
      });

      function closeLineModal() {
        if (!overlay) return;
        overlay.style.display = "none";
        overlay.setAttribute("aria-hidden", "true");
      }

      if (closeBtn) {
        closeBtn.addEventListener("click", () => {
          closeLineModal();
        });
      }

      if (overlay) {
        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) {
            closeLineModal();
          }
        });
      }
    }
  </script>
</body>
</html>
